# C# ä¸‰ç›®è¿ç®—ç¬¦ï¼ˆæ¡ä»¶è¿ç®—ç¬¦ï¼‰

ä¸‰ç›®è¿ç®—ç¬¦ï¼ˆä¹Ÿç§°ä¸ºæ¡ä»¶è¿ç®—ç¬¦ï¼‰æ˜¯ C# ä¸­å”¯ä¸€çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œæä¾›äº†ä¸€ç§ç®€æ´çš„æ¡ä»¶è¡¨è¾¾å¼å†™æ³•ã€‚å®ƒæ˜¯ `if-else` è¯­å¥çš„ç®€åŒ–å½¢å¼ã€‚

## åŸºæœ¬è¯­æ³•

```csharp
æ¡ä»¶è¡¨è¾¾å¼ ? å€¼1 : å€¼2
```

- å¦‚æœæ¡ä»¶è¡¨è¾¾å¼ä¸º `true`ï¼Œè¿”å›å€¼1
- å¦‚æœæ¡ä»¶è¡¨è¾¾å¼ä¸º `false`ï¼Œè¿”å›å€¼2

## åŸºæœ¬ç”¨æ³•

### 1. ç®€å•æ¡ä»¶åˆ¤æ–­

```csharp
int a = 10;
int b = 20;

// ä½¿ç”¨ä¸‰ç›®è¿ç®—ç¬¦
int max = a > b ? a : b;
Console.WriteLine($"è¾ƒå¤§çš„æ•°æ˜¯: {max}");  // è¾“å‡º: è¾ƒå¤§çš„æ•°æ˜¯: 20

// ç­‰ä»·çš„ if-else è¯­å¥
int max2;
if (a > b)
    max2 = a;
else
    max2 = b;

Console.WriteLine($"è¾ƒå¤§çš„æ•°æ˜¯: {max2}");  // è¾“å‡º: è¾ƒå¤§çš„æ•°æ˜¯: 20
```

### 2. å­—ç¬¦ä¸²æ“ä½œ

```csharp
string name = "";
string greeting = string.IsNullOrEmpty(name) ? "Hello, Guest!" : $"Hello, {name}!";
Console.WriteLine(greeting);  // è¾“å‡º: Hello, Guest!

name = "Alice";
greeting = string.IsNullOrEmpty(name) ? "Hello, Guest!" : $"Hello, {name}!";
Console.WriteLine(greeting);  // è¾“å‡º: Hello, Alice!
```

### 3. æ•°å€¼è®¡ç®—

```csharp
int score = 85;
string grade = score >= 90 ? "A" : 
               score >= 80 ? "B" : 
               score >= 70 ? "C" : 
               score >= 60 ? "D" : "F";

Console.WriteLine($"åˆ†æ•° {score} å¯¹åº”ç­‰çº§: {grade}");  // è¾“å‡º: åˆ†æ•° 85 å¯¹åº”ç­‰çº§: B

// åˆ¤æ–­å¥‡å¶æ€§
int number = 15;
string parity = number % 2 == 0 ? "å¶æ•°" : "å¥‡æ•°";
Console.WriteLine($"{number} æ˜¯ {parity}");  // è¾“å‡º: 15 æ˜¯ å¥‡æ•°
```

### 4. å¸ƒå°”å€¼è½¬æ¢

```csharp
bool isLoggedIn = true;
string status = isLoggedIn ? "å·²ç™»å½•" : "æœªç™»å½•";
Console.WriteLine($"ç”¨æˆ·çŠ¶æ€: {status}");  // è¾“å‡º: ç”¨æˆ·çŠ¶æ€: å·²ç™»å½•

// å¹´é¾„åˆ¤æ–­
int age = 17;
string category = age >= 18 ? "æˆå¹´äºº" : "æœªæˆå¹´äºº";
Console.WriteLine($"å¹´é¾„ {age}ï¼Œç±»åˆ«: {category}");  // è¾“å‡º: å¹´é¾„ 17ï¼Œç±»åˆ«: æœªæˆå¹´äºº
```

## åµŒå¥—ä½¿ç”¨

### 1. å¤šå±‚åµŒå¥—

```csharp
int temperature = 25;
string weather = temperature > 30 ? "ç‚çƒ­" :
                temperature > 20 ? "æ¸©æš–" :
                temperature > 10 ? "å‡‰çˆ½" :
                temperature > 0 ? "å¯’å†·" : "ä¸¥å¯’";

Console.WriteLine($"æ¸©åº¦ {temperature}Â°Cï¼Œå¤©æ°”: {weather}");  // è¾“å‡º: æ¸©åº¦ 25Â°Cï¼Œå¤©æ°”: æ¸©æš–
```

### 2. å¤æ‚æ¡ä»¶

```csharp
int hour = 14;
string timeOfDay = hour >= 6 && hour < 12 ? "ä¸Šåˆ" :
                  hour >= 12 && hour < 18 ? "ä¸‹åˆ" :
                  hour >= 18 && hour < 22 ? "æ™šä¸Š" : "æ·±å¤œ";

Console.WriteLine($"{hour}ç‚¹æ˜¯{timeOfDay}");  // è¾“å‡º: 14ç‚¹æ˜¯ä¸‹åˆ
```

### 3. ç±»å‹è½¬æ¢

```csharp
object value = 42;
string result = value is int intValue ? $"æ•´æ•°: {intValue}" :
               value is string strValue ? $"å­—ç¬¦ä¸²: {strValue}" :
               value is double doubleValue ? $"æµ®ç‚¹æ•°: {doubleValue}" :
               "æœªçŸ¥ç±»å‹";

Console.WriteLine(result);  // è¾“å‡º: æ•´æ•°: 42
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. å‚æ•°éªŒè¯

```csharp
class Calculator
{
    public static double Divide(double dividend, double divisor)
    {
        return divisor != 0 ? dividend / divisor : double.NaN;
    }
    
    public static string FormatNumber(double number)
    {
        return double.IsNaN(number) ? "æ— æ•ˆç»“æœ" : number.ToString("F2");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
double result1 = Calculator.Divide(10, 2);
double result2 = Calculator.Divide(10, 0);

Console.WriteLine($"10 Ã· 2 = {Calculator.FormatNumber(result1)}");  // è¾“å‡º: 10 Ã· 2 = 5.00
Console.WriteLine($"10 Ã· 0 = {Calculator.FormatNumber(result2)}");  // è¾“å‡º: 10 Ã· 0 = æ— æ•ˆç»“æœ
```

### 2. ç”¨æˆ·ç•Œé¢æ˜¾ç¤º

```csharp
class UserProfile
{
    public string Name { get; set; }
    public int Age { get; set; }
    public string Email { get; set; }
    
    public string GetDisplayName()
    {
        return !string.IsNullOrEmpty(Name) ? Name : "åŒ¿åç”¨æˆ·";
    }
    
    public string GetAgeCategory()
    {
        return Age < 13 ? "å„¿ç«¥" :
               Age < 20 ? "é’å°‘å¹´" :
               Age < 60 ? "æˆå¹´äºº" : "è€å¹´äºº";
    }
    
    public string GetContactInfo()
    {
        return !string.IsNullOrEmpty(Email) ? Email : "æœªæä¾›é‚®ç®±";
    }
}

// ä½¿ç”¨ç¤ºä¾‹
var user = new UserProfile { Name = "å¼ ä¸‰", Age = 25, Email = "zhangsan@example.com" };
Console.WriteLine($"ç”¨æˆ·: {user.GetDisplayName()}");
Console.WriteLine($"å¹´é¾„æ®µ: {user.GetAgeCategory()}");
Console.WriteLine($"è”ç³»æ–¹å¼: {user.GetContactInfo()}");
```

### 3. é…ç½®å’Œè®¾ç½®

```csharp
class AppSettings
{
    public static string GetDatabaseConnectionString(bool isProduction)
    {
        return isProduction ? 
            "Server=prod-server;Database=ProdDB;" :
            "Server=localhost;Database=DevDB;";
    }
    
    public static int GetCacheTimeout(string userType)
    {
        return userType == "Premium" ? 3600 :
               userType == "Standard" ? 1800 : 300;
    }
    
    public static string GetLogLevel(bool isDebugMode)
    {
        return isDebugMode ? "Debug" : "Info";
    }
}

// ä½¿ç”¨ç¤ºä¾‹
bool isProduction = false;
string connectionString = AppSettings.GetDatabaseConnectionString(isProduction);
Console.WriteLine($"æ•°æ®åº“è¿æ¥: {connectionString}");

string userType = "Premium";
int timeout = AppSettings.GetCacheTimeout(userType);
Console.WriteLine($"{userType} ç”¨æˆ·ç¼“å­˜è¶…æ—¶: {timeout} ç§’");
```

### 4. æ•°æ®å¤„ç†

```csharp
class DataProcessor
{
    public static string ProcessValue(object value)
    {
        return value switch
        {
            null => "ç©ºå€¼",
            string s => string.IsNullOrEmpty(s) ? "ç©ºå­—ç¬¦ä¸²" : s,
            int i => i > 0 ? $"æ­£æ•´æ•°: {i}" : i < 0 ? $"è´Ÿæ•´æ•°: {i}" : "é›¶",
            double d => double.IsNaN(d) ? "éæ•°å­—" : d.ToString("F2"),
            bool b => b ? "çœŸ" : "å‡",
            _ => "æœªçŸ¥ç±»å‹"
        };
    }
    
    public static T GetValueOrDefault<T>(T value, T defaultValue)
    {
        return value != null ? value : defaultValue;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
object[] values = { null, "", "Hello", 42, -10, 0, 3.14, double.NaN, true, false };

foreach (var value in values)
{
    Console.WriteLine($"å€¼: {value ?? "null"} -> å¤„ç†ç»“æœ: {DataProcessor.ProcessValue(value)}");
}
```

## ä¸ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦çš„ç»“åˆ

### 1. ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ (??)

```csharp
string name = null;
string displayName = name ?? "é»˜è®¤ç”¨æˆ·";
Console.WriteLine($"æ˜¾ç¤ºåç§°: {displayName}");  // è¾“å‡º: æ˜¾ç¤ºåç§°: é»˜è®¤ç”¨æˆ·

// ç»“åˆä¸‰ç›®è¿ç®—ç¬¦
string fullName = name != null ? $"æ¬¢è¿, {name}!" : "æ¬¢è¿, è®¿å®¢!";
string fullName2 = (name ?? "è®¿å®¢") == "è®¿å®¢" ? "æ¬¢è¿, è®¿å®¢!" : $"æ¬¢è¿, {name}!";

Console.WriteLine(fullName);   // è¾“å‡º: æ¬¢è¿, è®¿å®¢!
Console.WriteLine(fullName2);  // è¾“å‡º: æ¬¢è¿, è®¿å®¢!
```

### 2. ç©ºå€¼åˆå¹¶èµ‹å€¼è¿ç®—ç¬¦ (??=)

```csharp
string config = null;
config ??= "é»˜è®¤é…ç½®";  // ç­‰ä»·äº config = config ?? "é»˜è®¤é…ç½®"
Console.WriteLine($"é…ç½®: {config}");  // è¾“å‡º: é…ç½®: é»˜è®¤é…ç½®

// ç»“åˆä¸‰ç›®è¿ç®—ç¬¦è¿›è¡Œå¤æ‚èµ‹å€¼
string userPreference = null;
string theme = userPreference != null ? userPreference : 
               DateTime.Now.Hour < 18 ? "æµ…è‰²ä¸»é¢˜" : "æ·±è‰²ä¸»é¢˜";

Console.WriteLine($"ä¸»é¢˜: {theme}");
```

## æ€§èƒ½è€ƒè™‘

### 1. æ€§èƒ½å¯¹æ¯”

```csharp
using System.Diagnostics;

class PerformanceTest
{
    public static void ComparePerformance()
    {
        const int iterations = 10_000_000;
        int a = 10, b = 20;
        
        // æµ‹è¯•ä¸‰ç›®è¿ç®—ç¬¦
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < iterations; i++)
        {
            int max = a > b ? a : b;
        }
        sw.Stop();
        Console.WriteLine($"ä¸‰ç›®è¿ç®—ç¬¦è€—æ—¶: {sw.ElapsedMilliseconds} ms");
        
        // æµ‹è¯• if-else
        sw.Restart();
        for (int i = 0; i < iterations; i++)
        {
            int max;
            if (a > b)
                max = a;
            else
                max = b;
        }
        sw.Stop();
        Console.WriteLine($"if-else è€—æ—¶: {sw.ElapsedMilliseconds} ms");
        
        // æµ‹è¯• Math.Max
        sw.Restart();
        for (int i = 0; i < iterations; i++)
        {
            int max = Math.Max(a, b);
        }
        sw.Stop();
        Console.WriteLine($"Math.Max è€—æ—¶: {sw.ElapsedMilliseconds} ms");
    }
}
```

### 2. é¿å…é‡å¤è®¡ç®—

```csharp
// ä¸å¥½ï¼šé‡å¤è®¡ç®—
string result = GetExpensiveValue() != null ? GetExpensiveValue().ToString() : "é»˜è®¤å€¼";

// å¥½ï¼šç¼“å­˜è®¡ç®—ç»“æœ
var value = GetExpensiveValue();
string result2 = value != null ? value.ToString() : "é»˜è®¤å€¼";

// æ›´å¥½ï¼šä½¿ç”¨ç©ºå€¼åˆå¹¶
string result3 = GetExpensiveValue()?.ToString() ?? "é»˜è®¤å€¼";

static object GetExpensiveValue()
{
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    Thread.Sleep(1);
    return DateTime.Now.Millisecond % 2 == 0 ? "è®¡ç®—ç»“æœ" : null;
}
```

## ç±»å‹å®‰å…¨å’Œæœ€ä½³å®è·µ

### 1. ç±»å‹ä¸€è‡´æ€§

```csharp
// é”™è¯¯ï¼šç±»å‹ä¸ä¸€è‡´
// var result = condition ? 42 : "error";  // ç¼–è¯‘é”™è¯¯

// æ­£ç¡®ï¼šç¡®ä¿ç±»å‹ä¸€è‡´
object result1 = condition ? (object)42 : "error";
string result2 = condition ? "42" : "error";
int result3 = condition ? 42 : -1;

// ä½¿ç”¨æ³›å‹æ–¹æ³•
T GetValueOrDefault<T>(bool condition, T trueValue, T falseValue)
{
    return condition ? trueValue : falseValue;
}

string message = GetValueOrDefault(true, "æˆåŠŸ", "å¤±è´¥");
int number = GetValueOrDefault(false, 100, 0);
```

### 2. å¯è¯»æ€§ä¼˜åŒ–

```csharp
// ä¸å¥½ï¼šè¿‡äºå¤æ‚çš„åµŒå¥—
string status = user.IsActive ? 
                user.IsPremium ? 
                user.HasValidSubscription ? "é«˜çº§æ´»è·ƒç”¨æˆ·" : "é«˜çº§è¿‡æœŸç”¨æˆ·" :
                user.HasValidSubscription ? "æ™®é€šæ´»è·ƒç”¨æˆ·" : "æ™®é€šè¿‡æœŸç”¨æˆ·" :
                "éæ´»è·ƒç”¨æˆ·";

// å¥½ï¼šä½¿ç”¨æ–¹æ³•åˆ†è§£å¤æ‚é€»è¾‘
string GetUserStatus(User user)
{
    if (!user.IsActive) return "éæ´»è·ƒç”¨æˆ·";
    
    string userType = user.IsPremium ? "é«˜çº§" : "æ™®é€š";
    string subscriptionStatus = user.HasValidSubscription ? "æ´»è·ƒ" : "è¿‡æœŸ";
    
    return $"{userType}{subscriptionStatus}ç”¨æˆ·";
}

// æˆ–è€…ä½¿ç”¨ switch è¡¨è¾¾å¼ï¼ˆC# 8.0+ï¼‰
string GetUserStatusSwitch(User user) => user switch
{
    { IsActive: false } => "éæ´»è·ƒç”¨æˆ·",
    { IsPremium: true, HasValidSubscription: true } => "é«˜çº§æ´»è·ƒç”¨æˆ·",
    { IsPremium: true, HasValidSubscription: false } => "é«˜çº§è¿‡æœŸç”¨æˆ·",
    { IsPremium: false, HasValidSubscription: true } => "æ™®é€šæ´»è·ƒç”¨æˆ·",
    { IsPremium: false, HasValidSubscription: false } => "æ™®é€šè¿‡æœŸç”¨æˆ·"
};

class User
{
    public bool IsActive { get; set; }
    public bool IsPremium { get; set; }
    public bool HasValidSubscription { get; set; }
}
```

### 3. ç©ºå€¼å¤„ç†

```csharp
class SafeOperations
{
    // å®‰å…¨çš„å­—ç¬¦ä¸²æ“ä½œ
    public static string SafeSubstring(string input, int startIndex, int length)
    {
        return input != null && startIndex >= 0 && startIndex < input.Length ?
               input.Substring(startIndex, Math.Min(length, input.Length - startIndex)) :
               string.Empty;
    }
    
    // å®‰å…¨çš„æ•°ç»„è®¿é—®
    public static T SafeGetElement<T>(T[] array, int index, T defaultValue = default)
    {
        return array != null && index >= 0 && index < array.Length ?
               array[index] :
               defaultValue;
    }
    
    // å®‰å…¨çš„å±æ€§è®¿é—®
    public static string GetDisplayText(object obj)
    {
        return obj?.ToString() ?? "<null>";
    }
}

// ä½¿ç”¨ç¤ºä¾‹
string text = "Hello World";
string sub1 = SafeOperations.SafeSubstring(text, 6, 5);  // "World"
string sub2 = SafeOperations.SafeSubstring(null, 0, 5);  // ""
string sub3 = SafeOperations.SafeSubstring(text, 20, 5); // ""

int[] numbers = { 1, 2, 3, 4, 5 };
int value1 = SafeOperations.SafeGetElement(numbers, 2, -1);  // 3
int value2 = SafeOperations.SafeGetElement(numbers, 10, -1); // -1
int value3 = SafeOperations.SafeGetElement<int>(null, 0, -1); // -1
```

## å¸¸è§é”™è¯¯å’Œæ³¨æ„äº‹é¡¹

### 1. å‰¯ä½œç”¨é—®é¢˜

```csharp
int counter = 0;

// é”™è¯¯ï¼šå¯èƒ½äº§ç”Ÿæ„å¤–çš„å‰¯ä½œç”¨
int result = (++counter > 5) ? ResetCounter() : IncrementCounter();

// æ­£ç¡®ï¼šé¿å…åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä¿®æ”¹çŠ¶æ€
counter++;
int result2 = counter > 5 ? ResetCounter() : IncrementCounter();

int ResetCounter()
{
    counter = 0;
    return 0;
}

int IncrementCounter()
{
    return ++counter;
}
```

### 2. ç©ºå¼•ç”¨å¼‚å¸¸

```csharp
string text = null;

// é”™è¯¯ï¼šå¯èƒ½æŠ›å‡ºç©ºå¼•ç”¨å¼‚å¸¸
// string result = text.Length > 0 ? text.ToUpper() : "empty";

// æ­£ç¡®ï¼šå…ˆæ£€æŸ¥ç©ºå€¼
string result = text != null && text.Length > 0 ? text.ToUpper() : "empty";

// æ›´å¥½ï¼šä½¿ç”¨ç©ºå€¼æ¡ä»¶è¿ç®—ç¬¦
string result2 = text?.Length > 0 ? text.ToUpper() : "empty";
```

### 3. ç±»å‹è½¬æ¢é—®é¢˜

```csharp
object value = "123";

// é”™è¯¯ï¼šå¯èƒ½æŠ›å‡ºè½¬æ¢å¼‚å¸¸
// int number = value is string ? int.Parse((string)value) : 0;

// æ­£ç¡®ï¼šä½¿ç”¨å®‰å…¨è½¬æ¢
int number = value is string str && int.TryParse(str, out int parsed) ? parsed : 0;

// æˆ–è€…ä½¿ç”¨æ¨¡å¼åŒ¹é…
int number2 = value switch
{
    string s when int.TryParse(s, out int n) => n,
    int i => i,
    _ => 0
};
```

## æ€»ç»“

ä¸‰ç›®è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œç®€æ´çš„å·¥å…·ï¼Œé€‚ç”¨äºï¼š

### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯
- ç®€å•çš„æ¡ä»¶èµ‹å€¼
- å‚æ•°é»˜è®¤å€¼è®¾ç½®
- ç®€å•çš„æ ¼å¼åŒ–è¾“å‡º
- ç©ºå€¼æ£€æŸ¥å’Œé»˜è®¤å€¼

### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯
- å¤æ‚çš„å¤šå±‚åµŒå¥—é€»è¾‘
- åŒ…å«å‰¯ä½œç”¨çš„æ“ä½œ
- å¯è¯»æ€§è¦æ±‚å¾ˆé«˜çš„ä¸šåŠ¡é€»è¾‘
- éœ€è¦è¯¦ç»†é”™è¯¯å¤„ç†çš„åœºæ™¯

### ğŸ¯ æœ€ä½³å®è·µ
1. **ä¿æŒç®€æ´**ï¼šé¿å…è¿‡åº¦åµŒå¥—
2. **ç±»å‹ä¸€è‡´**ï¼šç¡®ä¿ä¸¤ä¸ªåˆ†æ”¯è¿”å›ç›¸åŒç±»å‹
3. **é¿å…å‰¯ä½œç”¨**ï¼šä¸è¦åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä¿®æ”¹çŠ¶æ€
4. **ä¼˜å…ˆå¯è¯»æ€§**ï¼šå¤æ‚é€»è¾‘ä½¿ç”¨ if-else æˆ– switch
5. **ç»“åˆå…¶ä»–è¿ç®—ç¬¦**ï¼šä¸ `??`ã€`?.` ç­‰è¿ç®—ç¬¦é…åˆä½¿ç”¨

ä¸‰ç›®è¿ç®—ç¬¦è™½ç„¶ç®€æ´ï¼Œä½†è¦åœ¨ç®€æ´æ€§å’Œå¯è¯»æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ï¼Œé€‰æ‹©æœ€é€‚åˆçš„è¡¨è¾¾æ–¹å¼ã€‚