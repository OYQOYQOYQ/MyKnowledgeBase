# C# 枚举 (Enum)

枚举类型（或称 enum 类型）是一种由一组已命名的基础整型数值类型的常量定义的值类型。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 当你有一组不会改变的值时，例如月份、星期几、颜色等，使用枚举会非常有用。 <mcreference link="https://www.w3schools.com/cs/cs_enums.php" index="2">2</mcreference>

## 1. 声明枚举

要定义一个枚举类型，使用 `enum` 关键字并指定枚举成员的名称。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference>

```csharp
enum Season
{
    Spring,
    Summer,
    Autumn,
    Winter
}
```

默认情况下，枚举成员的关联常量值的类型是 `int`；它们从零开始，并按照定义文本顺序递增一。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 例如，在上面的 `Season` 枚举中，`Spring` 是 0，`Summer` 是 1，依此类推。

### 1.1 指定基础类型和显式值

你可以显式指定任何其他整型数值类型作为枚举类型的基础类型。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 你也可以显式指定关联的常量值。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference>

```csharp
enum ErrorCode : ushort
{
    None = 0,
    Unknown = 1,
    ConnectionLost = 100,
    OutlierReading = 200
}
```

可用的基础类型有 `byte`, `sbyte`, `short`, `ushort`, `int`, `uint`, `long`, `ulong`。 <mcreference link="https://www.loginradius.com/blog/engineering/enum-csharp" index="5">5</mcreference> <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/enums" index="3">3</mcreference> `char` 类型不能用作基础类型。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/enums" index="3">3</mcreference>

如果一个枚举成员没有显式赋值，并且它是第一个成员，则其值为零。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/enums" index="3">3</mcreference> 否则，其值是前一个枚举成员的值加一。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/enums" index="3">3</mcreference>

```csharp
enum Months
{
  January,    // 0
  February,   // 1
  March=6,    // 6
  April,      // 7 (March + 1)
  May,        // 8 (April + 1)
}
```

## 2. 使用枚举

你可以像访问静态类成员一样访问枚举成员：

```csharp
Season currentSeason = Season.Summer;
Console.WriteLine(currentSeason); // 输出: Summer

ErrorCode error = ErrorCode.ConnectionLost;
Console.WriteLine(error); // 输出: ConnectionLost
```

### 2.1 获取枚举的整数值

要从枚举成员获取整数值，必须将成员显式转换为其基础类型（通常是 `int`）。 <mcreference link="https://www.w3schools.com/cs/cs_enums.php" index="2">2</mcreference>

```csharp
int summerValue = (int)Season.Summer;
Console.WriteLine(summerValue); // 输出: 1

ushort errorCodeValue = (ushort)ErrorCode.ConnectionLost;
Console.WriteLine(errorCodeValue); // 输出: 100
```

### 2.2 从整数值转换回枚举

你也可以将整数值转换回枚举类型：

```csharp
Season season = (Season)2;
Console.WriteLine(season); // 输出: Autumn

// 如果整数值没有对应的枚举成员，转换仍然有效，但打印时会显示该整数值
Season invalidSeason = (Season)5;
Console.WriteLine(invalidSeason); // 输出: 5
```

可以使用 `Enum.IsDefined` 方法来确定枚举类型是否包含具有特定关联值的枚举成员。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference>

```csharp
Console.WriteLine(Enum.IsDefined(typeof(Season), 2)); // 输出: True
Console.WriteLine(Enum.IsDefined(typeof(Season), "Autumn")); // 输出: True
Console.WriteLine(Enum.IsDefined(typeof(Season), 5)); // 输出: False
```

## 3. Flags特性 (位标志)

如果你希望枚举类型表示选项的组合（即位域），请为这些选项定义枚举成员，使每个选项都是一个位域（即，这些枚举成员的关联值应该是2的幂）。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 然后，你可以分别使用按位逻辑运算符 `|` 或 `&` 来组合选项或交叉组合选项。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 要指示枚举类型声明了位域，请对其应用 `Flags` 特性。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference>

```csharp
[Flags]
public enum Days
{
    None      = 0b_0000_0000,  // 0
    Monday    = 0b_0000_0001,  // 1
    Tuesday   = 0b_0000_0010,  // 2
    Wednesday = 0b_0000_0100,  // 4
    Thursday  = 0b_0000_1000,  // 8
    Friday    = 0b_0001_0000,  // 16
    Saturday  = 0b_0010_0000,  // 32
    Sunday    = 0b_0100_0000,  // 64
    Weekend   = Saturday | Sunday
}

public class FlagsEnumExample
{
    public static void Main()
    {
        Days meetingDays = Days.Monday | Days.Wednesday | Days.Friday;
        Console.WriteLine(meetingDays); // 输出: Monday, Wednesday, Friday

        Days workingFromHomeDays = Days.Thursday | Days.Friday;
        Console.WriteLine($"Join a meeting by phone on {meetingDays & workingFromHomeDays}"); // 输出: Join a meeting by phone on Friday

        bool isMeetingOnTuesday = (meetingDays & Days.Tuesday) == Days.Tuesday;
        Console.WriteLine($"Is there a meeting on Tuesday: {isMeetingOnTuesday}"); // 输出: Is there a meeting on Tuesday: False
    }
}
```

## 4. System.Enum 类

`System.Enum` 类型是所有枚举类型的抽象基类。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 它提供了许多方法来获取有关枚举类型及其值的信息。 <mcreference link="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum" index="1">1</mcreference> 例如：

- `Enum.GetNames(Type enumType)`: 返回指定枚举中常量名称的数组。 <mcreference link="https://www.loginradius.com/blog/engineering/enum-csharp" index="5">5</mcreference>
- `Enum.GetValues(Type enumType)`: 返回指定枚举中常量值的数组。
- `Enum.Parse(Type enumType, string value)`: 将一个或多个枚举常量的名称或数值的字符串表示形式转换为等效的枚举对象。 <mcreference link="https://www.loginradius.com/blog/engineering/enum-csharp" index="5">5</mcreference>
- `Enum.TryParse<TEnum>(string value, out TEnum result)`: 尝试将一个或多个枚举常量的名称或数值的字符串表示形式转换为等效的枚举对象。 <mcreference link="https://www.loginradius.com/blog/engineering/enum-csharp" index="5">5</mcreference>

```csharp
// 遍历枚举名称
foreach (string s in Enum.GetNames(typeof(Season)))
{
    Console.WriteLine(s);
}
// 输出:
// Spring
// Summer
// Autumn
// Winter

// 遍历枚举值
foreach (Season sVal in Enum.GetValues(typeof(Season)))
{
    Console.WriteLine((int)sVal);
}
// 输出:
// 0
// 1
// 2
// 3
```

## 5. 枚举的优点 <mcreference link="https://www.loginradius.com/blog/engineering/enum-csharp" index="5">5</mcreference>

- **类型安全**：枚举是强类型的，有助于防止将不相关的值赋给变量。
- **可读性**：使用有意义的名称代替魔术数字，使代码更易于理解和维护。
- **易于维护**：如果需要更改与名称关联的值，只需在枚举定义中更改即可，而无需在整个代码库中搜索和替换数字。

## 6. 枚举与 Switch 语句

枚举经常与 `switch` 语句一起使用，以检查相应的值。 <mcreference link="https://www.w3schools.com/cs/cs_enums.php" index="2">2</mcreference>

```csharp
Season mySeason = Season.Autumn;

switch (mySeason)
{
    case Season.Spring:
        Console.WriteLine("It's springtime!");
        break;
    case Season.Summer:
        Console.WriteLine("Summer fun!");
        break;
    case Season.Autumn:
        Console.WriteLine("Beautiful autumn leaves.");
        break;
    case Season.Winter:
        Console.WriteLine("Winter is coming.");
        break;
    default:
        Console.WriteLine("Unknown season.");
        break;
}
// 输出: Beautiful autumn leaves.
```